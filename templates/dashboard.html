<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="text-gray-900 transition-all duration-300 bg-gray-100">

    <!-- Sidebar -->
    <div class="flex min-h-screen">
        <aside class="sticky top-0 w-64 p-5 space-y-6 bg-white shadow-md">
    <div class="flex items-center justify-between">
        <h2 class="text-xl font-bold text-indigo-600">
            <i class="mr-2 fa-solid fa-wallet"></i>Expense Manager
        </h2>
        <button
            onclick="toggleDarkMode()"
            class="text-gray-500 hover:text-indigo-500"
            title="Toggle Dark Mode"
        >
            <i class="fa-solid fa-moon"></i>
        </button>
    </div>

    <div class="space-y-3">
        <a
            href="{{ url_for('dashboard') }}"
            class="flex items-center gap-3 px-3 py-2 text-indigo-700 bg-indigo-100 rounded"
        >
            <i class="fa-solid fa-chart-line"></i> Dashboard
        </a>
        <a
            href="{{ url_for('profile') }}"
            class="flex items-center gap-3 px-3 py-2 text-indigo-700 rounded hover:bg-indigo-100"
        >
            <i class="fa-solid fa-user"></i> Profile
        </a>
        <a
            href="{{ url_for('add_expense') }}"
            class="flex items-center gap-3 px-3 py-2 text-indigo-700 rounded hover:bg-indigo-100"
        >
            <i class="fa-solid fa-plus"></i> Add Expense
        </a>
        <a
            href="{{ url_for('expense_history') }}"
            class="flex items-center gap-3 px-3 py-2 text-indigo-700 rounded hover:bg-indigo-100"
        >
            <i class="fa-solid fa-clock-rotate-left"></i> Expense History
        </a>
        <a
            href="{{ url_for('about') }}"
            class="flex items-center gap-3 px-3 py-2 text-indigo-700 rounded hover:bg-indigo-100"
        >
            <i class="fa-solid fa-circle-info"></i> About
        </a>
        {% if user.role == 'admin' %}
        <a
            href="{{ url_for('admin_panel') }}"
            class="flex items-center gap-3 px-3 py-2 text-red-700 rounded hover:bg-red-100"
        >
            <i class="fa-solid fa-user-shield"></i> Admin Panel
        </a>
        {% endif %}
        <!-- New Feedback Link -->
    <a href="{{ url_for('feedback') }}" class="block px-3 py-2 text-indigo-700 rounded hover:bg-indigo-100">
      <i class="mr-2 fa-solid fa-comments"></i>Feedback
    </a>
        <a
            href="{{ url_for('logout') }}"
            class="flex items-center gap-3 px-3 py-2 text-gray-700 rounded hover:bg-gray-200"
        >
            <i class="fa-solid fa-right-from-bracket"></i> Logout
        </a>
    </div>
        </aside>



        <!-- Main Content -->
        <main class="flex-1 p-10 space-y-10">
            <h1 class="mb-4 text-3xl font-bold text-blue-500">Welcome, {{ user.username }}!</h1>

            <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
                <div class="p-6 transition duration-300 transform bg-white shadow rounded-xl hover:shadow-xl ">
                    <h2 class="mb-2 text-lg font-semibold">
                      <i class="mr-2 text-green-600 fa-solid fa-sack-dollar"></i>Total Expenses
                    </h2>
                    <p class="text-2xl font-bold text-green-700">₹{{ total }}</p>
                    <p class="mt-3 text-sm text-gray-600">
                       This amount represents the total expenses you have incurred so far. Monitoring your total spending helps you understand where your money goes each month. By keeping an eye on these expenses, you can identify opportunities to save and plan your finances better for future goals. Tracking your expenses regularly can improve your budgeting skills, reduce unnecessary costs, and ensure you stay on top of your financial health. Use this insight to make informed decisions and achieve greater financial stability.
                    </p>
            </div>



                <div
                    class="p-6 transition duration-300 transform bg-white shadow rounded-xl hover:shadow-xl "
                >
                    <h2 class="mb-2 text-lg font-semibold">
                        <i class="mr-2 text-purple-600 fa-solid fa-chart-pie"></i>Category Breakdown
                    </h2>
                    {% if category_breakdown %}
                    <div class="space-y-4">
                        {% for category, amount in category_breakdown.items() %}
                        <div>
                            <div class="flex justify-between text-sm font-medium">
                                <span>{{ category }}</span>
                                <span>₹{{ '%.2f'|format(amount) }}</span>
                            </div>
                            <div class="w-full h-2 bg-gray-200 rounded-full">
                                <div
                                    class="h-2 transition-all duration-500 bg-indigo-500 rounded-full"
                                    style="width: {{ (amount / total * 100)|round(0, 'floor') }}%"
                                ></div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <p class="text-sm text-gray-500">No data available.</p>
                    {% endif %}
                </div>

                <div
                    class="p-6 transition duration-300 transform bg-white shadow rounded-xl hover:shadow-xl md:col-span-2"
                >
                    <h2 class="mb-4 text-lg font-semibold">
                        <i class="mr-2 text-blue-600 fa-solid fa-clock-rotate-left"></i>Recent Expenses
                    </h2>
                    {% if recent_expenses %}
                    <ul class="space-y-2 text-sm">
                        {% for exp in recent_expenses %}
                        <li class="flex justify-between pb-2 border-b">
                            {{ exp.description or exp.category }} - ₹{{ '%.2f'|format(exp.amount) }}
                            <span class="text-gray-400">{{ exp.date.strftime('%b %d') }}</span>
                        </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p class="text-sm text-gray-500">No recent expenses available.</p>
                    {% endif %}
                </div>

               
                <!-- Monthly Trend Section -->
                 <!-- Add this inside your main content area, before Monthly Trend Section -->


                <div
                    class="p-6 transition duration-300 transform bg-white shadow rounded-xl hover:shadow-xl md:col-span-2"
                >
                
                    <h2 class="mb-2 text-lg font-semibold">
                        <i class="mr-2 text-pink-500 fa-solid fa-chart-line"></i>Monthly Trend
                    </h2>
                      <form method="get" action="{{ url_for('dashboard') }}" id="yearForm" class="flex items-center justify-end mb-4 space-x-4">
    <label for="year" class="text-sm font-medium text-gray-700">Select Year:</label>

    <select name="year" id="year" onchange="this.form.submit()" class="p-2 text-sm border rounded-lg shadow">
        {% for year in year_options %}
            <option value="{{ year }}" {% if year == selected_year %}selected{% endif %}>{{ year }}</option>
        {% endfor %}
    </select>

    <div class="text-sm font-semibold text-gray-700">
        {% if selected_year == current_year %}
            Monthly Budget: ₹{{ monthly_budget }}
        {% else %}
            Total Expenses: ₹{{ yearly_total | round(2) }}
        {% endif %}
    </div>
</form>

                    <canvas id="monthlyTrendChart" class="w-full h-16 mt-4"></canvas>
                </div>
            </div>
        </main>
    </div>

    <!-- Dark Mode Script -->
    <script>
        function toggleDarkMode() {
            document.body.classList.toggle("bg-gray-900");
            document.body.classList.toggle("text-black");
        }
    </script>

    <!-- Chart.js Script -->
    <script>
        const monthlyTrends = {{ monthly_trends | tojson | safe }};

        const ctx = document.getElementById('monthlyTrendChart').getContext('2d');
        const monthlyTrendChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: monthlyTrends.labels,
                datasets: [{
                    label: 'Expenses (₹)',
                    data: monthlyTrends.data,
                    backgroundColor: 'rgba(219, 39, 119, 0.7)', // pink color
                    borderColor: 'rgba(219, 39, 119, 1)',
                    borderWidth: 1,
                    borderRadius: 5,
                    maxBarThickness: 40,
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return '₹' + value;
                            }
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return '₹' + context.parsed.y;
                            }
                        }
                    }
                }
            }
        });
    </script>
</body>

</html>
